<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kairos - Threat Intelligence Triage</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <header class="app-header">
            <div class="header-left">
                <h1><img src="/favicon.svg" alt="" class="header-logo">Kairos</h1>
            </div>
            <nav class="header-nav" id="header-nav">
                <!-- Nav links will be populated by JS based on user role -->
            </nav>
        </header>

        <!-- Action toolbar -->
        <div class="toolbar">
            <div class="toolbar-left">
                <span id="remaining-count" class="count-badge">Loading...</span>
                <span id="status-message" class="status-message"></span>
            </div>
            <div class="toolbar-right">
                <button id="undo-btn" class="toolbar-btn hidden" onclick="undoLastAction()">
                    ‚Ü∂ Undo
                </button>
                <button id="skip-all-btn" class="toolbar-btn toolbar-btn-warning" onclick="skipAllItems()">
                    ‚è≠ Skip All
                </button>
            </div>
        </div>

        <main id="main-content">
            <!-- Priority 1 Panel -->
            <section class="triage-panel" id="panel-priority1">
                <div class="panel-header">
                    <h2 class="panel-title">üî• Priority 1</h2>
                    <span class="panel-count" id="count-priority1">Loading...</span>
                </div>
                <div class="panel-content" id="content-priority1">
                    <!-- Item will be loaded here -->
                </div>
            </section>

            <!-- Standard RSS Panel -->
            <section class="triage-panel" id="panel-standard">
                <div class="panel-header">
                    <h2 class="panel-title">üì∞ Standard Feeds</h2>
                    <span class="panel-count" id="count-standard">Loading...</span>
                </div>
                <div class="panel-content" id="content-standard">
                    <!-- Item will be loaded here -->
                </div>
            </section>

        </main>

        <footer>
            <div class="footer-content">
                <div class="footer-links">
                    <a href="/api/metrics" target="_blank" class="footer-link">Metrics</a>
                    <a href="/api/digest/latest" target="_blank" class="footer-link">Latest Digest</a>
                    <a href="#" onclick="generateDigestNow(); return false;" class="footer-link">Generate Digest</a>
                    <a href="#" onclick="showHelp(); return false;" class="footer-link">Help (?)</a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Keyboard Shortcuts</h3>
            <div class="shortcuts">
                <div class="shortcut">
                    <kbd>A</kbd>
                    <span>Mark as Immediate Alert (send webhook)</span>
                </div>
                <div class="shortcut">
                    <kbd>D</kbd>
                    <span>Add to Daily Digest</span>
                </div>
                <div class="shortcut">
                    <kbd>S</kbd>
                    <span>Skip (no action)</span>
                </div>
                <div class="shortcut">
                    <kbd>U</kbd>
                    <span>Undo last action</span>
                </div>
                <div class="shortcut">
                    <kbd>?</kbd>
                    <span>Show this help</span>
                </div>
            </div>
            <button onclick="hideHelp()" class="btn btn-primary">Close</button>
        </div>
    </div>

    <!-- Feed Management Modal -->
    <div id="feed-modal" class="modal hidden">
        <div class="modal-content modal-wide">
            <div class="modal-header">
                <h3>Manage RSS Feeds</h3>
                <button onclick="hideFeedManager()" class="btn-close">&times;</button>
            </div>

            <!-- Add RSS Feed Form -->
            <div class="feed-form">
                <h4>Add RSS Feed</h4>
                <form id="add-feed-form" onsubmit="addFeed(event)">
                    <div class="form-group">
                        <label for="feed-url">Feed URL *</label>
                        <input type="url" id="feed-url" placeholder="https://example.com/feed.xml" required>
                    </div>
                    <div class="form-group">
                        <label for="feed-name">Feed Name (optional)</label>
                        <input type="text" id="feed-name" placeholder="Will auto-detect if empty">
                    </div>
                    <div class="form-group">
                        <label for="feed-priority">Priority (1-5)</label>
                        <input type="number" id="feed-priority" min="1" max="5" value="3">
                        <small>1 = most important, 5 = least important</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Add RSS Feed</button>
                </form>
            </div>

            <!-- Feed List -->
            <div class="feed-list-container">
                <h4>Current Feeds</h4>
                <div id="feed-list-loading" class="loading-inline">
                    <div class="spinner-small"></div>
                    <span>Loading feeds...</span>
                </div>
                <div id="feed-list" class="feed-list"></div>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
